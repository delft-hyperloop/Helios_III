import _extends from "@babel/runtime/helpers/esm/extends";
import * as React from 'react';
import { InteractionContext } from '../../context/InteractionProvider';
import { getIsHighlighted, getIsFaded } from '../../hooks/useInteractionItemProps';
export function useTransformData(series) {
  var seriesId = series.id,
    highlightScope = series.highlightScope,
    data = series.data,
    faded = series.faded,
    highlighted = series.highlighted,
    _series$paddingAngle = series.paddingAngle,
    basePaddingAngle = _series$paddingAngle === void 0 ? 0 : _series$paddingAngle,
    _series$innerRadius = series.innerRadius,
    baseInnerRadius = _series$innerRadius === void 0 ? 0 : _series$innerRadius,
    baseArcLabelRadius = series.arcLabelRadius,
    baseOuterRadius = series.outerRadius,
    _series$cornerRadius = series.cornerRadius,
    baseCornerRadius = _series$cornerRadius === void 0 ? 0 : _series$cornerRadius;
  var _React$useContext = React.useContext(InteractionContext),
    highlightedItem = _React$useContext.item;
  var getHighlightStatus = React.useCallback(function (dataIndex) {
    var isHighlighted = getIsHighlighted(highlightedItem, {
      type: 'pie',
      seriesId: seriesId,
      dataIndex: dataIndex
    }, highlightScope);
    var isFaded = !isHighlighted && getIsFaded(highlightedItem, {
      type: 'pie',
      seriesId: seriesId,
      dataIndex: dataIndex
    }, highlightScope);
    return {
      isHighlighted: isHighlighted,
      isFaded: isFaded
    };
  }, [highlightScope, highlightedItem, seriesId]);
  var dataWithHighlight = React.useMemo(function () {
    return data.map(function (item, itemIndex) {
      var _attributesOverride$p, _attributesOverride$i, _attributesOverride$o, _attributesOverride$c, _ref, _attributesOverride$a;
      var _getHighlightStatus = getHighlightStatus(itemIndex),
        isHighlighted = _getHighlightStatus.isHighlighted,
        isFaded = _getHighlightStatus.isFaded;
      var attributesOverride = _extends({
        additionalRadius: 0
      }, isFaded && faded || isHighlighted && highlighted || {});
      var paddingAngle = Math.max(0, Math.PI * ((_attributesOverride$p = attributesOverride.paddingAngle) != null ? _attributesOverride$p : basePaddingAngle) / 180);
      var innerRadius = Math.max(0, (_attributesOverride$i = attributesOverride.innerRadius) != null ? _attributesOverride$i : baseInnerRadius);
      var outerRadius = Math.max(0, (_attributesOverride$o = attributesOverride.outerRadius) != null ? _attributesOverride$o : baseOuterRadius + attributesOverride.additionalRadius);
      var cornerRadius = (_attributesOverride$c = attributesOverride.cornerRadius) != null ? _attributesOverride$c : baseCornerRadius;
      var arcLabelRadius = (_ref = (_attributesOverride$a = attributesOverride.arcLabelRadius) != null ? _attributesOverride$a : baseArcLabelRadius) != null ? _ref : (innerRadius + outerRadius) / 2;
      return _extends({}, item, attributesOverride, {
        isFaded: isFaded,
        isHighlighted: isHighlighted,
        paddingAngle: paddingAngle,
        innerRadius: innerRadius,
        outerRadius: outerRadius,
        cornerRadius: cornerRadius,
        arcLabelRadius: arcLabelRadius
      });
    });
  }, [baseCornerRadius, baseInnerRadius, baseOuterRadius, basePaddingAngle, baseArcLabelRadius, data, faded, getHighlightStatus, highlighted]);
  return dataWithHighlight;
}